{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://maestro.flow.dev/schemas/session-metadata.schema.json",
  "title": "Maestro Session Metadata",
  "description": "Metadata for a Maestro orchestration session including status, timestamps, and configuration",
  "type": "object",
  "required": [
    "session_id",
    "feature_request",
    "status",
    "created_at",
    "git_context"
  ],
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique identifier for the session (UUID v4)",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },
    "feature_request": {
      "type": "string",
      "description": "Original feature request provided by user"
    },
    "status": {
      "type": "string",
      "description": "Current session status",
      "enum": [
        "initializing",
        "planning",
        "generating_tasks",
        "implementing",
        "validating",
        "generating_report",
        "completed",
        "failed",
        "paused"
      ]
    },
    "current_phase": {
      "type": "string",
      "description": "Current execution phase",
      "enum": [
        "plan",
        "generate_tasks",
        "implement",
        "validate",
        "cleanup"
      ]
    },
    "created_at": {
      "type": "string",
      "description": "Session creation timestamp",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "description": "Last update timestamp",
      "format": "date-time"
    },
    "completed_at": {
      "type": "string",
      "description": "Session completion timestamp (null if not completed)",
      "format": "date-time"
    },
    "git_context": {
      "type": "object",
      "description": "Git repository context at session start",
      "required": ["branch", "commit", "repo_root"],
      "properties": {
        "branch": {
          "type": "string",
          "description": "Git branch name"
        },
        "commit": {
          "type": "string",
          "description": "Git commit SHA",
          "pattern": "^[0-9a-f]{7,40}$"
        },
        "repo_root": {
          "type": "string",
          "description": "Absolute path to repository root"
        },
        "is_worktree": {
          "type": "boolean",
          "description": "Whether session is running in a worktree"
        },
        "worktree_name": {
          "type": "string",
          "description": "Worktree name if applicable"
        }
      }
    },
    "prd_reference": {
      "type": "object",
      "description": "Reference to generated PRD",
      "properties": {
        "filename": {
          "type": "string",
          "description": "PRD filename"
        },
        "path": {
          "type": "string",
          "description": "Absolute path to PRD"
        },
        "version": {
          "type": "string",
          "description": "PRD version"
        }
      }
    },
    "statistics": {
      "type": "object",
      "description": "Session execution statistics",
      "properties": {
        "total_tasks": {
          "type": "integer",
          "description": "Total number of tasks",
          "minimum": 0
        },
        "completed_tasks": {
          "type": "integer",
          "description": "Number of completed tasks",
          "minimum": 0
        },
        "failed_tasks": {
          "type": "integer",
          "description": "Number of failed tasks",
          "minimum": 0
        },
        "decisions_made": {
          "type": "integer",
          "description": "Number of decisions made",
          "minimum": 0
        },
        "checkpoints_created": {
          "type": "integer",
          "description": "Number of git checkpoints created",
          "minimum": 0
        },
        "error_recovery_count": {
          "type": "integer",
          "description": "Number of error recovery attempts",
          "minimum": 0
        },
        "duration_seconds": {
          "type": "number",
          "description": "Session duration in seconds",
          "minimum": 0
        }
      }
    },
    "configuration": {
      "type": "object",
      "description": "Session configuration",
      "properties": {
        "max_iterations": {
          "type": "integer",
          "description": "Maximum refinement iterations",
          "default": 3,
          "minimum": 1
        },
        "timeout_minutes": {
          "type": "integer",
          "description": "Session timeout in minutes",
          "default": 120,
          "minimum": 1
        },
        "auto_checkpoint": {
          "type": "boolean",
          "description": "Whether to auto-create checkpoints",
          "default": true
        },
        "error_recovery_enabled": {
          "type": "boolean",
          "description": "Whether error recovery is enabled",
          "default": true
        }
      }
    }
  }
}
